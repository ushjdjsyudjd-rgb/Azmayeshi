<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø´Ø¹Ø¨Ù‡ Ú¯ÛŒÙ„ Ø±Ø´Øª</title>
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† ØªÙ„ÙˆÛŒÙ†Ø¯ Ø¨Ø±Ø§ÛŒ Ù„ÙˆØ¯ Ø³Ø±ÛŒØ¹ */
        @font-face {
            font-family: 'Vazir';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Regular.woff2') format('woff2');
        }
        body { font-family: 'Vazir', Tahoma, sans-serif; background-color: #f8fafc; margin: 0; padding: 16px; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .bmi-card { background: linear-gradient(135deg, #0d66a1 0%, #228cc8 100%); border-radius: 30px; padding: 25px 20px; color: white; display: flex; flex-direction: column; align-items: center; text-align: center; box-shadow: 0 10px 25px rgba(13, 102, 161, 0.2); gap: 10px; margin-bottom: 20px; }
        .digital-clock { font-size: 3rem; font-weight: 900; line-height: 1; font-family: sans-serif; }
        .service-row { background: white; border-radius: 20px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; cursor: pointer; text-decoration: none; color: inherit; }
        .flex-row { display: flex; align-items: center; gap: 12px; }
        .icon-box { width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .btn-call { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 10px 25px; border-radius: 50px; color: white; font-weight: bold; font-size: 13px; margin-top: 10px; cursor: pointer; }
        
        /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ØµÙØ­Ø§Øª */
        .page { display: none; width: 100%; min-height: 100vh; }
        .active-page { display: block; }
        
        #splash-screen { position: fixed; inset: 0; z-index: 9999; background: #0d66a1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; transition: opacity 0.5s; }
        
        /* Ú†Øª */
        .chat-container { position: fixed; inset: 0; background: #f1f5f9; z-index: 100; display: flex; flex-direction: column; }
        .messages-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 13px; }
        .user-bubble { align-self: flex-end; background: #0d66a1; color: white; border-bottom-right-radius: 2px; }
        .admin-bubble { align-self: flex-start; background: white; color: #333; border-bottom-left-radius: 2px; }
        
        /* ÙØ±Ù… */
        .input-field { width: 90%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 15px; font-family: 'Vazir'; }
        .btn-submit { width: 100%; background: #0d66a1; color: white; padding: 15px; border-radius: 15px; border: none; font-weight: bold; font-size: 16px; }

        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ */
        .new-msg-alert { color: #fbbf24; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div id="splash-screen">
        <h1 style="font-size: 24px; font-weight: 900;">Ø¨Ø§Ù†Ú© Ù…Ù„ÛŒ Ø§ÛŒØ±Ø§Ù†</h1>
        <p>Ø´Ø¹Ø¨Ù‡ Ú¯ÛŒÙ„ Ø±Ø´Øª</p>
        <div style="margin-top:20px;">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
    </div>

    <div id="main-page" class="page active-page">
        <div class="bmi-card">
            <div id="digiClock" class="digital-clock" onclick="promptAdmin()">00:00</div>
            <div style="background:#fbbf24; color:#0d66a1; padding:2px 15px; border-radius:20px; font-size:11px; font-weight:bold;">Ø´Ø¹Ø¨Ù‡ Ú¯ÛŒÙ„ Ø±Ø´Øª - Û³Û·Û±Û¶</div>
            <div id="shamsiDate" style="font-size:13px; margin-top:5px;">...</div>
            <button onclick="toggleModal(true)" class="btn-call">ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ Ø´Ø¹Ø¨Ù‡</button>
        </div>

        <a href="https://baam.bmi.ir" class="service-row">
            <div class="flex-row">
                <div class="icon-box" style="background:#eff6ff; color:#2563eb;">ğŸŒ</div>
                <div><b style="font-size:14px;">Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§Ù… Ù…Ù„ÛŒ</b><br><small style="color:#94a3b8;">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡</small></div>
            </div>
            <span>â®</span>
        </a>

        <div class="service-row" onclick="showPage('form-page')">
            <div class="flex-row">
                <div class="icon-box" style="background:#0d66a1; color:white;">ğŸ“</div>
                <div><b style="font-size:14px;">ÙØ±Ù… Ù¾Ø±Ø³Ø´Ù†Ø§Ù…Ù‡</b><br><small style="color:#94a3b8;">Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ</small></div>
            </div>
            <span style="color:#0d66a1; font-weight:bold;">Ø´Ø±ÙˆØ¹ â®</span>
        </div>
    </div>

    <div id="form-page" class="page" style="padding:20px; background:white;">
        <h2 style="text-align:center; color:#0d66a1;">ÙˆØ±ÙˆØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h2>
        <form id="infoForm" onsubmit="handleReview(event)">
            <input type="text" name="national_id" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ" class="input-field" required maxlength="10">
            <input type="text" name="fname" placeholder="Ù†Ø§Ù…" class="input-field" required>
            <input type="text" name="lname" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" class="input-field" required>
            <input type="text" name="mobile" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„" class="input-field" required maxlength="11">
            <textarea name="addr" placeholder="Ø¢Ø¯Ø±Ø³ Ù…Ù†Ø²Ù„" class="input-field" style="height:80px;" required></textarea>
            <button type="submit" class="btn-submit">Ø«Ø¨Øª Ùˆ Ø¨Ø±Ø±Ø³ÛŒ</button>
            <button type="button" onclick="showPage('main-page')" style="width:100%; background:none; border:none; color:#94a3b8; margin-top:15px; font-weight:bold;">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </form>
    </div>

    <div id="chat-page" class="page chat-container">
        <div style="background:#0d66a1; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center;">
            <button onclick="showPage('main-page')" style="background:none; border:none; color:white; font-weight:bold;">âœ•</button>
            <b style="font-size:16px;">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</b>
            <div style="width:20px;"></div>
        </div>
        <div id="chat-messages" class="messages-area"></div>
        <div style="padding:10px; background:white; display:flex; gap:10px; border-top:1px solid #ddd;">
            <input type="text" id="user-input" placeholder="Ù¾ÛŒØ§Ù… Ø´Ù…Ø§..." style="flex:1; padding:12px; border-radius:10px; border:1px solid #ddd;">
            <button onclick="sendChatMessage('user')" style="background:#0d66a1; color:white; padding:0 20px; border-radius:10px; border:none;">Ø§Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <div id="admin-page" class="page chat-container" style="background:#f8fafc;">
        <div style="background:#1e293b; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center;">
            <button onclick="showPage('main-page')" style="background:#ef4444; color:white; border:none; padding:5px 15px; border-radius:8px;">Ø®Ø±ÙˆØ¬</button>
            <b>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</b>
            <button onclick="fetchMessages()" style="background:none; border:none; color:white; font-size:20px;">ğŸ”„</button>
        </div>
        <div id="admin-list" style="padding:15px; overflow-y:auto;"></div>
    </div>

    <div id="contactModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:200; align-items:center; justify-content:center; padding:20px;">
        <div style="background:white; width:100%; border-radius:25px; padding:20px;">
            <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø´Ø¹Ø¨Ù‡</h3>
            <button onclick="openChat()" style="width:100%; padding:15px; background:#10b981; color:white; border-radius:15px; border:none; font-weight:bold; margin-bottom:10px;">ğŸ’¬ Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</button>
            <a href="tel:01333666474" style="display:block; text-align:center; padding:15px; background:#f1f5f9; border-radius:15px; text-decoration:none; color:#333; margin-bottom:10px;">ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ Ø±ÛŒØ§Ø³Øª</a>
            <button onclick="toggleModal(false)" style="width:100%; background:none; border:none; color:#ef4444; font-weight:bold;">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        const CHAT_API = 'https://sheetdb.io/api/v1/czatwlt4x2234';
        let lastCount = 0;

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            window.scrollTo(0,0);
        }

        function toggleModal(s) { document.getElementById('contactModal').style.display = s ? 'flex' : 'none'; }
        function openChat() { toggleModal(false); showPage('chat-page'); }

        function promptAdmin() {
            let pass = prompt("Ø±Ù…Ø² ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„:");
            if(pass === "5762") {
                document.getElementById('digiClock').classList.remove('new-msg-alert');
                showPage('admin-page');
                fetchMessages();
            }
        }

        async function sendChatMessage(role, msgText = null) {
            const input = document.getElementById('user-input');
            const text = msgText || input.value;
            if(!text) return;
            try {
                await fetch(CHAT_API, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({data: [{sender: role==='user'?'Ù…Ø´ØªØ±ÛŒ':'Ù…Ø¯ÛŒØ±ÛŒØª', message: text, role: role, timestamp: new Date().toLocaleTimeString('fa-IR')}]})
                });
                if(!msgText) input.value = '';
                fetchMessages();
            } catch(e) {}
        }

        async function fetchMessages() {
            try {
                const res = await fetch(CHAT_API);
                const data = await res.json();
                
                // Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯
                if(data.length > lastCount && lastCount !== 0) {
                    document.getElementById('digiClock').classList.add('new-msg-alert');
                }
                lastCount = data.length;

                const cBox = document.getElementById('chat-messages');
                cBox.innerHTML = data.map(m => `
                    <div class="bubble ${m.role==='user'?'user-bubble':'admin-bubble'}">
                        <small style="display:block; font-size:9px; opacity:0.7;">${m.sender}</small>
                        ${m.message}
                    </div>
                `).join('');
                cBox.scrollTop = cBox.scrollHeight;

                const aBox = document.getElementById('admin-list');
                aBox.innerHTML = data.filter(m => m.role==='user').reverse().map(m => `
                    <div style="background:white; padding:15px; border-radius:15px; margin-bottom:10px; border:1px solid #ddd;">
                        <small style="color:blue;">${m.timestamp}</small>
                        <p style="margin:5px 0; font-weight:bold;">${m.message}</p>
                        <button onclick="replyToUser('${m.message}')" style="background:#0d66a1; color:white; border:none; padding:5px 15px; border-radius:5px; width:100%;">Ù¾Ø§Ø³Ø®</button>
                    </div>
                `).join('');
            } catch(e) {}
        }

        function replyToUser(txt) {
            let r = prompt("Ù¾Ø§Ø³Ø® Ø¨Ù‡: " + txt);
            if(r) sendChatMessage('admin', r);
        }

        function handleReview(e) {
            e.preventDefault();
            alert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øª Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±...");
            showPage('main-page');
        }

        // Ø³Ø§Ø¹Øª Ùˆ ØªØ§Ø±ÛŒØ®
        setInterval(() => {
            const n = new Date();
            document.getElementById('digiClock').textContent = String(n.getHours()).padStart(2,'0')+":"+String(n.getMinutes()).padStart(2,'0');
        }, 1000);
        document.getElementById('shamsiDate').textContent = new Intl.DateTimeFormat('fa-IR', {weekday:'long',year:'numeric',month:'long',day:'numeric'}).format(new Date());

        // Ø­Ø°Ù Splash
        window.addEventListener('load', () => {
            setTimeout(() => {
                const s = document.getElementById('splash-screen');
                s.style.opacity = '0';
                setTimeout(() => s.remove(), 500);
            }, 1500);
        });

        // Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ú†Øª
        setInterval(() => { if(!document.hidden) fetchMessages(); }, 10000);
    </script>
</body>
</html>
